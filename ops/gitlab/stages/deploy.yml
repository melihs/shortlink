include:
  - local: /ops/gitlab/workflows/matrix_deploy.yml

# STAGING RELEASE ======================================================================================================
applications:
  extends:
    - .matrix_deploy_provider
    - .matrix_deploy_application
  stage: deploy
  variables:
    PROVIDER: $PROVIDER
    RELEASE_NAME: $RELEASE_NAME
    REGISTRY: $REGISTRY
    HELM_PATH: $HELM_PATH
    HELM_NAMESPACE: $HELM_NAMESPACE
    HELM_ARG: $HELM_ARG
    ENVIRONMENT_URL: https://${ENVIRONMENT_URL}
  trigger:
    include:
      - local: 'ops/gitlab/pipelines/helm_deploy.yml'
    strategy: depend
  needs:
    # NOTE: We use ArgoCD for deploy applications, except for UI [landing]
    # - pipeline: docker
    - ui
  rules:
    - if: $CI_COMMIT_TAG

mobile:
  stage: deploy
  trigger:
    include:
      - local: 'ops/gitlab/pipelines/flutter.yml'
  needs: []
  rules:
    - if: $CI_COMMIT_TAG
      when: on_success
