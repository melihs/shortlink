include:
  - local: /ops/gitlab/templates/common.yml

stages:
  - .pre
  - publish

publish:
  stage: publish
  image: node:18-alpine
  variables:
    NPM_TOKEN: $CI_JOB_TOKEN
  before_script:
    # Set URL for your scoped packages.
    - npm config set @shortlink:registry ${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/npm/
    # Add the token for the scoped packages URL.
    # with the project where your package is located.
    - npm config set //${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN}
    - cd $PACKAGE_PATH
  script:
    - echo "Publishing $APPLICATION"
