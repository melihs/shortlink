delete_renovate_branch:
  stage: .pre
  image: alpine
  before_script:
    - apk add --update git
    - git config --global user.name "${GITLAB_USER_NAME}"
    - git config --global user.email "${GITLAB_USER_EMAIL}"
  script:
    - git remote add gitlab https://${GITLAB_USER_NAME}:${CI_GIT_TOKEN}@${CI_REPOSITORY_URL#*@}
    - git branch -r | awk -Fgitlab/ '/\/renovate/ {print $2}' | xargs -I {} git push gitlab :{}
  rules:
    - when: always
      if: $CI_PIPELINE_SOURCE == "schedule"

