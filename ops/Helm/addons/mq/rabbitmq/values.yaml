# Common default values for rabbitmq-cluster-operator.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

email: mymail@gmail.com

annotations: {}

rabbitmq:
  enabled: true

  auth:
    username: admin
    password: admin
    erlangCookie: randomCookie

  podSecurityContext:
    enabled: true

  persistence:
    enabled: false

  extraVolumeMounts:
    - name: tmp
      mountPath: /tmp
      readOnly: false
    - name: opt
      mountPath: /opt/bitnami/rabbitmq
      readOnly: false

  extraVolumes:
    - name: tmp
      emptyDir: {}
    - name: opt
      emptyDir: {}

  initContainers:
    - name: data-copy
      image: bitnami/rabbitmq
      imagePullPolicy: IfNotPresent
      volumeMounts:
        - name: opt
          mountPath: "/mnt/opt/bitnami/rabbitmq"
      command:
        - /bin/bash
      args:
        - -ec
        - cp -r -v "/opt/bitnami/rabbitmq/." "/mnt/opt/bitnami/rabbitmq"

  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      cert-manager.io/cluster-issuer: cert-manager-production
      nginx.ingress.kubernetes.io/enable-modsecurity: "true"
      nginx.ingress.kubernetes.io/enable-owasp-core-rules: "true"
      nginx.ingress.kubernetes.io/enable-opentracing: "true"
      nginx.ingress.kubernetes.io/rewrite-target: /$1
      nginx.ingress.kubernetes.io/use-regex: "true"

    hostname: architecture.ddns.net
    path: /rabbitmq/?(.*)

    # For Kubernetes >= 1.18 you should specify the pathType (determines how Ingress paths should be matched)
    # See https://kubernetes.io/blog/2020/04/02/improvements-to-the-ingress-api-in-kubernetes-1.18/#better-path-matching-with-path-types
    pathType: Prefix

    tls: true
    certManager: true

  metrics:
    enabled: true

    serviceMonitor:
      enabled: true

    prometheusRule:
      enabled: true
