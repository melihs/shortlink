# Common default values for argo-cd.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
# Ref: https://github.com/argoproj/argo-cd

argo:
  enabled: true

argo-cd:
  fullnameOverride: argocd

  global:
    logging:
      format: json

  controller:
    metrics:
      enabled: true
      applicationLabels:
        enabled: true
      serviceMonitor:
        enabled: true
    rules:
      enabled: true

  dex:
    enabled: true

    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

  redis:
    enabled: false

  externalRedis:
    host: shortlink-redis-master.redis

  server:
    extraArgs:
      - --rootpath
      - /argocd
      - --basehref
      - /argocd

    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

    ingress:
      enabled: true

      ingressClassName: nginx

      annotations:
        cert-manager.io/cluster-issuer: cert-manager-production
        nginx.ingress.kubernetes.io/backend-protocol: HTTPS
        nginx.ingress.kubernetes.io/configuration-snippet: |-
          proxy_ssl_server_name on;
          proxy_ssl_name $host;
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/secure-backends: "true"
        nginx.ingress.kubernetes.io/enable-modsecurity: "true"
        nginx.ingress.kubernetes.io/enable-owasp-core-rules: "true"
        nginx.ingress.kubernetes.io/enable-opentracing: "true"

      hosts:
        - architecture.ddns.net

      paths:
        - /argocd(/|$)(.*)

      tls:
        - secretName: shortlink-ingress-tls
          hosts:
            - architecture.ddns.net

      https: true

    config:
      url: https://architecture.ddns.net/argocd

    rbacConfig:
      policy.csv: |
        p, role:org-admin, applications, *, */*, allow
        p, role:org-admin, clusters, get, *, allow
        p, role:org-admin, repositories, get, *, allow
        p, role:org-admin, repositories, create, *, allow
        p, role:org-admin, repositories, update, *, allow
        p, role:org-admin, repositories, delete, *, allow
        g, devops, role:admin
        g, gitlab, role:org-admin
      policy.default: role:readonly

    extensions:
      enabled: true

  repoServer:
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

    volumes:
      - name: custom-tools
        emptyDir: {}

  applicationSet:
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

  notifications:
    argocdUrl: https://architecture.ddns.net/argocd

    secret: {}

    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

  configs:
    repositories:
      shortlink:
        url: https://github.com/batazor/shortlink
        name: shortlink
        type: git

argo-events:
  fullnameOverride: argo-events

argo-workflows:
  fullnameOverride: argo-workflows
