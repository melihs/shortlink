{{/* vim: set filetype=mustache: */}}

{{- define "shortlink-common.probe" }}
  {{- if .startupProbe }}
  startupProbe:
    httpGet:
      path: {{ .startupProbe.path | default "/healthz" }}
      port: {{ .startupProbe.port | default 9090 }}
    initialDelaySeconds: 5
    periodSeconds: 5
    successThreshold: 1
    failureThreshold: 1
  {{- end }}

  {{- if .livenessProbe }}
  # -- define a liveness probe that checks every 5 seconds, starting after 5 seconds
  livenessProbe:
    httpGet:
      path: {{ .livenessProbe.path | default "/live" }}
      port: {{ .livenessProbe.port | default 9090 }}
    initialDelaySeconds: 5
    periodSeconds: 5
    successThreshold: 1
    failureThreshold: 1
  {{- end }}

  {{- if .readinessProbe }}
  # -- define a readiness probe that checks every 5 seconds, starting after 5 seconds
  readinessProbe:
    httpGet:
      path: {{ .readinessProbe.path | default "/ready" }}
      port: {{ .readinessProbe.port | default 9090 }}
    initialDelaySeconds: 5
    periodSeconds: 5
    successThreshold: 1
    failureThreshold: 30
  {{- end }}
{{- end }}
