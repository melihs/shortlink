apiVersion: kargo.akuity.io/v1alpha1
kind: Stage
metadata:
  name: test
spec:
  subscriptions:
    repos:
      git:
        - repoURL: git@github.com:shortlink-org/shortlink.git
          branch: main
  promotionMechanisms:
    gitRepoUpdates:
      - repoURL: git@github.com:shortlink-org/shortlink.git
        writeBranch: stage/test
    argoCDAppUpdates:
      - appName: kargo-demo-test
        appNamespace: argocd

---
apiVersion: kargo.akuity.io/v1alpha1
kind: Stage
metadata:
  name: prod
spec:
  subscriptions:
    upstreamStages:
      - name: test
  promotionMechanisms:
    gitRepoUpdates:
      - repoURL: git@github.com:shortlink-org/shortlink.git
        writeBranch: stage/prod
    argoCDAppUpdates:
      - appName: kargo-demo-prod
        appNamespace: argocd

---
apiVersion: kargo.akuity.io/v1alpha1
kind: PromotionPolicy
metadata:
  name: stage-promotion
stage: test
authorizedPromoters:
  - subjectType: User
    name: kubernetes-admin
enableAutoPromotion: true
