{{/* vim: set filetype=mustache: */}}

{{- define "shortlink-common.deploymentStrategy" }}

{{- if and (eq .Values.deploy.type "Rollout") (eq .Values.deploy.strategy "blueGreen") -}}
blueGreen:
  activeService: {{ include "helpers.fullname" . }}
  previewService: {{ include "helpers.fullname" . }}-preview
  autoPromotionEnabled: false
{{- else if and (eq .Values.deploy.type "Rollout") (eq .Values.deploy.strategy "canary") -}}
canary:
  stableService: {{ include "helpers.fullname" . }}
  canaryService: {{ include "helpers.fullname" . }}-preview
  dynamicStableScale: true
  {{ toYaml .Values.deploy.canary | nindent 2 }}
{{- else -}}
type: RollingUpdate
rollingUpdate:
  maxSurge: 1
  maxUnavailable: 0
{{- end }}
