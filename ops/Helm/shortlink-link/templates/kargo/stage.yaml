apiVersion: kargo.akuity.io/v1alpha1
kind: Stage
metadata:
  name: shorltink-link-test
spec:
  subscriptions:
    repos:
      git:
        - repoURL: https://github.com/shortlink-org/shortlink.git
          branch: main
  promotionMechanisms:
    gitRepoUpdates:
      - repoURL: https://github.com/shortlink-org/shortlink.git
        writeBranch: stage/test
    argoCDAppUpdates:
      - appName: shortlink-link
        appNamespace: argocd

---
apiVersion: kargo.akuity.io/v1alpha1
kind: Stage
metadata:
  name: shorltink-link-prod
spec:
  subscriptions:
    upstreamStages:
      - name: test
  promotionMechanisms:
    gitRepoUpdates:
      - repoURL: https://github.com/shortlink-org/shortlink.git
        writeBranch: stage/prod
    argoCDAppUpdates:
      - appName: shortlink-link-prod
        appNamespace: argocd

---
apiVersion: kargo.akuity.io/v1alpha1
kind: PromotionPolicy
metadata:
  name: shorltink-link-promotion
stage: test
enableAutoPromotion: true
