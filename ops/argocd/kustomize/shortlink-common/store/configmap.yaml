apiVersion: v1
kind: ConfigMap
metadata:
  name: shortlink-init-sql
data:
  init.sql: |
    -- link database
    \c link;
    CREATE SCHEMA AUTHORIZATION link;
    GRANT ALL PRIVILEGES ON DATABASE link TO link;
    ALTER DATABASE link OWNER TO link;

    ALTER DATABASE link SET statement_timeout = '180s';

    -- billing database
    \c billing;
    CREATE SCHEMA AUTHORIZATION billing;
    GRANT ALL PRIVILEGES ON DATABASE billing TO billing;
    ALTER DATABASE billing OWNER TO billing;

    ALTER DATABASE link SET statement_timeout = '600s';

    -- proxy database
    \c proxy;
    CREATE SCHEMA AUTHORIZATION proxy;
    GRANT ALL PRIVILEGES ON DATABASE proxy TO proxy;
    ALTER DATABASE proxy OWNER TO proxy;

    ALTER DATABASE link SET statement_timeout = '180s';
