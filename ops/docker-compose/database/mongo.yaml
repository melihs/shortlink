version: '2.4'

services:

  mongo: &mongo
    image: mongo:4.2
    init: true
    restart: on-failure
    container_name: mongo
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_DATABASE: shortlink
    networks:
      - simple
    dns:
      - "10.5.0.2"
    dns_search: coredns

  mongo_initial_state:
    <<: *mongo
    container_name: mongo_initial_state
    depends_on:
      - mongo
    command: >
      bash -c "mongoimport \
                -h=mongo:27017 \
                -d auth \
                -c users \
                --mode merge \
                --file /initialState/links.json"
    ports:
      - "27018:27017"
    networks:
      - simple
    dns:
      - "10.5.0.2"
    dns_search: coredns
    volumes:
      - ./initialState:/initialState
