################################################################
# Middlewares
################################################################

[http.middlewares]
  # Latency Check
  [http.middlewares.latency-check.circuitBreaker]
    expression = "LatencyAtQuantileMS(50.0) > 100"

  [http.middlewares.test-compress.compress]
    excludedContentTypes = ["text/event-stream"]

  # Custom Error Page for 5XX
  [http.middlewares.test-errorpage.errors]
    status = ["500-599"]
    service = "serviceError"
    query = "/{status}.html"

  # 100 reqs/s
  [http.middlewares.test-ratelimit.rateLimit]
    average = 100

  # Retry to send request 4 times
  [http.middlewares.test-retry.retry]
    attempts = 4

################################################################
# ROUTERS
################################################################
[http.routers]
  [http.routers.metadata]
    rule = "PathPrefix(`/rpc.Metadata/`)"
    service = "metadata"

################################################################
# SERVICES
################################################################
[http.services]
  [http.services.metadata]
    [http.services.metadata.loadBalancer]
      [[http.services.metadata.loadBalancer.servers]]
        url = "h2c://192.168.1.56:50052"
