version: '2.4'

services:

  zookeeper:
    image: wurstmeister/zookeeper
    hostname: zookeeper
    expose:
      - "2181"
    ports:
      - "2181:2181"

  kafka:
    image: wurstmeister/kafka
    restart: on-failure
    container_name: kafka
    depends_on:
      - zookeeper
    ports:
      - '9092:9092'
      - '8082:8082'
      - '8083:8083'
    environment:
      KAFKA_ADVERTISED_HOST_NAME: kafka
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_CONNECT_BOOTSTRAP_SERVERS: localhost:9092

      KAFKA_CONNECT_REST_PORT: 8082
      KAFKA_CONNECT_REST_ADVERTISED_HOST_NAME: "localhost"

      KAFKA_CONNECT_KEY_CONVERTER: "org.apache.kafka.connect.json.JsonConverter"
      KAFKA_CONNECT_VALUE_CONVERTER: "org.apache.kafka.connect.json.JsonConverter"
      KAFKA_CONNECT_KEY_CONVERTER_SCHEMAS_ENABLE: 0
      KAFKA_CONNECT_VALUE_CONVERTER_SCHEMAS_ENABLE: 0

      KAFKA_CONNECT_INTERNAL_KEY_CONVERTER: "org.apache.kafka.connect.json.JsonConverter"
      KAFKA_CONNECT_INTERNAL_VALUE_CONVERTER: "org.apache.kafka.connect.json.JsonConverter"
      KAFKA_CONNECT_INTERNAL_KEY_CONVERTER_SCHEMAS_ENABLE: 0
      KAFKA_CONNECT_INTERNAL_VALUE_CONVERTER_SCHEMAS_ENABLE: 0

      KAFKA_CONNECT_OFFSET_STORAGE_FILE_FILENAME: "/tmp/connect.offsets"
      # Flush much faster than normal, which is useful for testing/debugging
      KAFKA_CONNECT_OFFSET_FLUSH_INTERVAL_MS: 10000

  lenses:
    image: lensesio/lenses
    environment:
      LENSES_PORT: 9991
      LENSES_KAFKA_BROKERS: "PLAINTEXT://kafka:9092"

      # # If you have enabled JMX for your brokers, set the port here
      # LENSES_KAFKA_METRICS_DEFAULT_PORT: 9581

      # # If you use AVRO, configure the Schema Registry
      # LENSES_SCHEMA_REGISTRY_URLS: |
      #   [
      #     {url:"http://schema.registry.1.url:8081"},
      #     {url:"http://schema.registry.2.url:8081"}
      #   ]

      # # If you use Kafka Connect, configure the workers.
      # LENSES_KAFKA_CONNECT_CLUSTERS: |
      #   [
      #     {
      #       name:"data_science",
      #       urls: [
      #         {url:"http://connect.worker.1.url:8083"},
      #         {url:"http://connect.worker.2.url:8083"}
      #       ],
      #       statuses:"connect-statuses-cluster-a",
      #       configs:"connect-configs-cluster-a",
      #       offsets:"connect-offsets-cluster-a"
      #     }
      #   ]

      # Zookeeper access is optional
      LENSES_ZOOKEEPER_HOSTS: |
        [
         {url:"zookeeper:2181"}
        ]

      # # Users are managed within Lenses. Here you can change the superuser username:
      LENSES_SECURITY_USER: admin
      # # Users are managed within Lenses. Here you can change the superuser password:
      LENSES_SECURITY_PASSWORD: admin
    ports:
      - 9991:9991
      - 9102:9102
    volumes:
      - ./ops/docker-compose/mq/license.json:/license.json
    network_mode: host
