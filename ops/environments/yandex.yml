include:
  - local: /ops/templates/job_template_deploy.yml

# STAGING RELEASE ======================================================================================================

deploy:staging:
  extends:
    - .job_template_deploy
  stage: test # TODO: delete
  variables:
    ENVIRONMENT: yandex-staging
    RELEASE_NAME: $CI_PROJECT_NAME
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}
  environment:
    name: yandex-staging
    url: staging.example.com
#  needs:
#    - build:shortlink
#    - build:logger
#    - build:ui
  only:
    refs:
      - branches # TODO: delete
#      - /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/


# PRODUCTION RELEASE ===================================================================================================

deploy:production:
  extends:
    - .job_template_deploy
  variables:
    ENVIRONMENT: yandex-production
    RELEASE_NAME: $CI_PROJECT_NAME
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}
  environment:
    name: yandex-production
    url: production.example.com
  needs:
    - build:shortlink
    - build:logger
    - build:ui
  only:
    - /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.?(?:0|[1-9]\d*)?$/
